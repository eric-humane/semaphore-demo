- name: Create temporary build directory
  ansible.builtin.tempfile:
    state: directory
    suffix: demo-build
  register: build_temp_dir_result


- name: Store build directory path
  ansible.builtin.set_fact:
    build_temp_dir: "{{ build_temp_dir_result.path }}"
  notify: Remove build temp dir


- name: Get application source code
  ansible.builtin.git:
    repo: https://github.com/semaphoreui/semaphore-demo-app.git
    dest: "{{ build_temp_dir }}"
    force: true


- name: Builds an artifact and stores it in storage
  ansible.builtin.archive:
    path: "{{ build_temp_dir }}"
    dest: /tmp/demo-app-{{ semaphore_vars.task_details.target_version }}.tar.gz
    format: gz


- name: Print final version
  ansible.builtin.debug:
    msg: "Version {{ semaphore_vars.task_details.target_version }} was built and ready for deployment."
